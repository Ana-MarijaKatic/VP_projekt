<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>
<style>
    *{
        font-size: 12px;
    }

    #tooltip {
        background-color: #ecf0f1;
        visibility: hidden;
        position: absolute;
        opacity: 0.9;
        padding: 10px;
        vertical-align: middle;
        border-radius: 5px;
        text-align: center;
        width: 140px;
        font-size: 16px;
    }
    .rectangle:hover{
       opacity: 0.3; 
    }
</style>

<body>
    <script>
        /*d3.json("Twitch_game_data.json", function(data) {
            d3.select("body")
                .selectAll("p")
                .data(data)
                .enter()
                .append("p")
                .text(function(d){
                    while(d.Month==1 && d.Year==2016){
                        return d.Game;
                        
                        
                    }
                });
        });
*/

        var globalData;
        var yearData = [];
        var monthData = [];
        var hoursWatchedData = [];
        var avgViewersData = [];
        var peakViewersData = [];
        var gamesStreamedData = []; 

        d3.json("Twitch_global_data.json", function (data) {
            globalData = data;
            fetchData();
            displayData();
        })

        function fetchData() {
            var temp_hoursWatchedData = [];

            globalData.forEach(function (data) {
                if (true) {
                    monthData.push(data.Month);
                    yearData.push(data.year);
                    hoursWatchedData.push(data.Hours_watched);
                    avgViewersData.push(data.Avg_viewers);
                    peakViewersData.push(data.Peak_viewers);
                    gamesStreamedData.push(data.Games_streamed);
                }
            });
        }

       /* function displayYearData() {

        }
*/

        function displayData() {
            //console.log(hoursWatchedData);

            /*
            var data = [480241904, 441859897, 490669308, 377975447, 449836631, 446429345, 446331825, 382117373, 362833210, 453035001, 449688428, 490484523];
            var hours_watched = [];
            data.forEach(function (hours, index) {
                hours_watched[index] = Math.floor(hours / 1000000);
            });
            */
            //console.log(hours_watched);
            var margin = { top: 20, bottom: 70, left: 80, right: 60 }
            var width = 1800 - margin.left - margin.right;
            var height = 300 - margin.top - margin.bottom;

            /*var color = d3.scaleLinear()
                .domain([0, d3.max(monthData)])
                .range(["white", "blue"]);
            */
            var color = d3.scaleOrdinal()
                .domain(hoursWatchedData)
                .range(["#EF476F", "#EF476F", "#EF476F", "#EF476F", "#EF476F", "#EF476F", "#EF476F", "#EF476F", "#EF476F", "#EF476F", "#EF476F", "#EF476F",
                    "#F78C6B", "#F78C6B", "#F78C6B", "#F78C6B", "#F78C6B", "#F78C6B", "#F78C6B", "#F78C6B", "#F78C6B", "#F78C6B", "#F78C6B", "#F78C6B",
                    "#FFD166", "#FFD166", "#FFD166", "#FFD166", "#FFD166", "#FFD166", "#FFD166", "#FFD166", "#FFD166", "#FFD166", "#FFD166", "#FFD166",
                    "#06D6A0", "#06D6A0", "#06D6A0", "#06D6A0", "#06D6A0", "#06D6A0", "#06D6A0", "#06D6A0", "#06D6A0", "#06D6A0", "#06D6A0", "#06D6A0",
                    "#118AB2", "#118AB2", "#118AB2", "#118AB2", "#118AB2", "#118AB2", "#118AB2", "#118AB2", "#118AB2", "#118AB2", "#118AB2", "#118AB2",
                    "#073B4C", "#073B4C", "#073B4C", "#073B4C", "#073B4C", "#073B4C", "#073B4C", "#073B4C", "#073B4C", "#073B4C", "#073B4C", "#073B4C"]);

            var svg = d3.select("body")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var x = d3.scaleBand()
                .domain(d3.range(hoursWatchedData.length))
                .rangeRound([0, width])
                .paddingInner(0.05);

            var y = d3.scaleLinear()
                .domain([0, d3.max(hoursWatchedData)])
                .range([height, 0]);



            var xAxis = d3.axisBottom(x)
                .tickSize(0)
                .tickFormat(function (d, i) {
                    if (i < 12) {
                        return i + 1;
                    }
                    else {
                        return i % 12 + 1;
                    }
                });
            var yAxis = d3.axisLeft(y)
                .tickSize(0)
                .tickFormat(function (d) {
                    return d/1000000;
                });

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + (height + 2) + ")")
                .call(xAxis)
                .append("text")
                .attr("x", width / 2)
                .attr("dy", "4em")
                .style("text-anchor", "end")
                .style("fill", "black")
                .text("Months");


            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(0)")
                .attr("x", 75)
                .attr("dy", "-0.8em")
                .style("text-anchor", "end")
                .style("fill", "black")
                .text("Millions of hours watched");

            const tooltip = d3.select("body")
                .append("div")
                .attr("id", "tooltip")
                .style("visibility", "hidden");


            var barchart = svg.selectAll("rect")
                .data(hoursWatchedData)
                .enter()
                .append("rect")
                .attr("class","rectangle")
                .attr("x", function (d, i) {
                    return x(i);
                })
                .attr("y", function (d) { return y(d); })
                .attr("width", x.bandwidth())
                .attr("height", function (d) { return height - y(d); })
                .attr("fill", function (d, i) {
                    return color(d);
                })
                .attr("stroke", "white")
                .on("mouseover", function (d,i) {
                    tooltip.style("visibility", "visible")
                        .style("left", event.pageX + 10 + "px")
                        .style("top", event.pageY - 100 + "px")
                        .html("Hours watched: " + d + " " + "<spam>&asymp;</spam>" + "<br> " + Math.ceil(d/1000000) + " millions" +"<br>" + "Month: " + monthData[i] + "<br>" + "Year: " + yearData[i] + ".");
                })
                .on("mousemove", function () {
                    tooltip.style("left", event.pageX + 10 + "px")
                })
                .on("mouseout", function () {
                    tooltip.style("visibility", "hidden")
                });
        }

    </script>
</body>

</html>